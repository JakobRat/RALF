v {xschem version=3.4.1 file_version=1.2
}
G {}
K {}
V {}
S {}
E {}
N -890 -70 -890 0 {
lab=GND}
N -890 -190 -890 -130 {
lab=VDD}
N -650 -210 -550 -210 {
lab=vd}
N -650 -170 -550 -170 {
lab=GND}
N -600 -170 -600 -150 {
lab=GND}
N -690 -160 -690 -120 {
lab=Vcmm}
N -690 -120 -510 -120 {
lab=Vcmm}
N -510 -160 -510 -120 {
lab=Vcmm}
N -600 -120 -600 -80 {
lab=Vcmm}
N -600 -20 -600 0 {
lab=GND}
N -690 -270 -690 -220 {
lab=Vp}
N -510 -270 -510 -220 {
lab=Vn}
N -790 -70 -790 0 {
lab=GND}
N -790 -180 -790 -130 {
lab=vd}
N -130 -50 -130 0 {
lab=GND}
N -130 -80 -60 -80 {
lab=GND}
N -60 -80 -60 -20 {
lab=GND}
N -130 -20 -60 -20 {
lab=GND}
N -130 -160 -130 -110 {
lab=Vbias}
N -240 -80 -170 -80 {
lab=Vbias}
N -240 -140 -240 -80 {
lab=Vbias}
N 210 -160 300 -160 {
lab=Vp}
N 210 -140 300 -140 {
lab=Vn}
N 210 -180 300 -180 {
lab=Vbias2}
N 210 -120 300 -120 {
lab=Vbias}
N 600 -180 640 -180 {
lab=VDD}
N 640 -240 640 -180 {
lab=VDD}
N 600 -120 640 -120 {
lab=GND}
N 640 -120 640 -60 {
lab=GND}
N 600 -160 700 -160 {
lab=Voutn}
N 600 -140 700 -140 {
lab=Voutp}
N 700 -140 730 -140 {
lab=Voutp}
N 730 -140 730 -110 {
lab=Voutp}
N 730 -50 730 -30 {
lab=GND}
N 700 -160 730 -160 {
lab=Voutn}
N 730 -200 730 -160 {
lab=Voutn}
N 730 -280 730 -260 {
lab=GND}
N 60 170 90 170 {
lab=#net1}
N 60 120 60 170 {
lab=#net1}
N 60 120 420 120 {
lab=#net1}
N 420 120 420 210 {
lab=#net1}
N 390 210 420 210 {
lab=#net1}
N 30 190 90 190 {
lab=Vcmm}
N 30 210 90 210 {
lab=VcmmOut}
N 30 230 90 230 {
lab=Vbias}
N 390 170 400 170 {
lab=VDD}
N 400 60 400 170 {
lab=VDD}
N 390 230 420 230 {
lab=GND}
N 420 230 420 270 {
lab=GND}
N 390 190 490 190 {
lab=Vbias2}
N -40 210 30 210 {
lab=VcmmOut}
N 0 190 30 190 {
lab=Vcmm}
N 0 80 -0 190 {
lab=Vcmm}
N -50 80 -0 80 {
lab=Vcmm}
N -240 -140 -130 -140 {
lab=Vbias}
N -130 -520 -130 -460 {
lab=VDD}
N -130 -400 -130 -370 {
lab=VbiasP}
N -190 -430 -170 -430 {
lab=VbiasP}
N -190 -430 -190 -380 {
lab=VbiasP}
N -190 -380 -130 -380 {
lab=VbiasP}
N -130 -430 -90 -430 {
lab=VDD}
N -90 -490 -90 -430 {
lab=VDD}
N -130 -490 -90 -490 {
lab=VDD}
N -130 -310 -130 -270 {
lab=VbiasP}
N -130 -210 -130 -160 {
lab=Vbias}
N -130 -370 -130 -310 {
lab=VbiasP}
N 40 -330 60 -330 {
lab=#net2}
N 120 -330 150 -330 {
lab=#net3}
N 210 -330 230 -330 {
lab=#net4}
N 290 -330 310 -330 {
lab=#net5}
N 370 -330 410 -330 {
lab=Vbias}
N -50 -330 -20 -330 {
lab=VbiasP}
N 10 -380 10 -350 {
lab=GND}
N 10 -380 340 -380 {
lab=GND}
N 340 -380 340 -350 {
lab=GND}
N 260 -380 260 -350 {
lab=GND}
N 180 -380 180 -350 {
lab=GND}
N 90 -380 90 -350 {
lab=GND}
N -150 390 -130 390 {
lab=#net6}
N -70 390 -40 390 {
lab=#net7}
N 20 390 40 390 {
lab=#net8}
N 100 390 120 390 {
lab=#net9}
N 180 390 220 390 {
lab=VcmmOut}
N -240 390 -210 390 {
lab=Voutp}
N -180 340 -180 370 {
lab=GND}
N -180 340 150 340 {
lab=GND}
N 150 340 150 370 {
lab=GND}
N 70 340 70 370 {
lab=GND}
N -10 340 -10 370 {
lab=GND}
N -100 340 -100 370 {
lab=GND}
N -150 640 -130 640 {
lab=#net10}
N -70 640 -40 640 {
lab=#net11}
N 20 640 40 640 {
lab=#net12}
N 100 640 120 640 {
lab=#net13}
N 180 640 220 640 {
lab=VcmmOut}
N -240 640 -210 640 {
lab=Voutn}
N -180 660 -180 690 {
lab=GND}
N -180 690 150 690 {
lab=GND}
N 150 660 150 690 {
lab=GND}
N 70 660 70 690 {
lab=GND}
N -10 660 -10 690 {
lab=GND}
N -100 660 -100 690 {
lab=GND}
N 220 390 240 390 {
lab=VcmmOut}
N 240 390 240 640 {
lab=VcmmOut}
N 220 640 240 640 {
lab=VcmmOut}
N 240 510 300 510 {
lab=VcmmOut}
N -10 320 -10 340 {
lab=GND}
N -10 690 -10 700 {
lab=GND}
N -10 700 -10 710 {
lab=GND}
N 180 -400 180 -380 {
lab=GND}
C {devices/vsource.sym} -890 -100 0 0 {name=V3 value=1.8}
C {devices/gnd.sym} -890 0 0 0 {name=l3 lab=GND}
C {devices/vdd.sym} -890 -190 0 0 {name=l4 lab=VDD}
C {devices/vcvs.sym} -690 -190 0 1 {name=E1 value=0.5}
C {devices/vcvs.sym} -510 -190 0 0 {name=E2 value=-0.5}
C {devices/vsource.sym} -600 -50 0 0 {name=Vcmm value=0.9}
C {devices/gnd.sym} -600 0 0 0 {name=l8 lab=GND}
C {devices/lab_wire.sym} -690 -270 0 1 {name=p6 sig_type=std_logic lab=Vp}
C {devices/lab_wire.sym} -510 -270 0 1 {name=p7 sig_type=std_logic lab=Vn}
C {devices/gnd.sym} -600 -150 0 0 {name=l9 lab=GND}
C {devices/lab_wire.sym} -610 -210 0 1 {name=p8 sig_type=std_logic lab=vd}
C {devices/vsource.sym} -790 -100 0 0 {name=Vd value="dc 0 ac 1"}
C {devices/gnd.sym} -790 0 0 0 {name=l10 lab=GND}
C {devices/lab_wire.sym} -790 -180 0 1 {name=p9 sig_type=std_logic lab=vd}
C {sky130_fd_pr/nfet_01v8.sym} -150 -80 0 0 {name=M6
L=2
W=1
nf=1 
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=nfet_01v8
spiceprefix=X
}
C {devices/gnd.sym} -130 0 0 0 {name=l5 lab=GND}
C {devices/vdd.sym} -130 -520 0 0 {name=l6 lab=VDD}
C {devices/lab_wire.sym} -130 -210 0 0 {name=p5 sig_type=std_logic lab=Vbias}
C {devices/simulator_commands.sym} -830 -690 0 0 {name=COMMANDS
simulator=ngspice
only_toplevel=false 
value="
* ngspice commands
.option savecurrents
.save all
.control
ac dec 1001 1 100Meg
let vod = V(Voutp)-V(Voutn)
meas ac gain max vod
let gain3dB = gain/sqrt(2)
meas ac BW TRIG at=1 TARG vod val=gain3dB fall=LAST
let GBW = BW*gain*1e-6
print GBW
print vodmax
plot vdb(vod) xlimit 1k 100Meg ylabel 'small signal gain'
let outd = 180/PI*cph(vod)
meas ac ftHz when vdb(vod)=1 fall=LAST
meas ac ph find outd when vdb(vod)=0 fall=LAST
let phm = ph+180
print phm
settype phase outd
plot outd xlimit 1k 100Meg ylabel 'phase'
dc Vd -0.02 0.02 1m
let vod = V(Voutp)-V(Voutn)
plot vod
op
write MillerOpAmp_tb.raw
.endc
"}
C {devices/code_shown.sym} -640 -710 0 0 {name=ngspice 
only_toplevel=false 
format="tcleval( @value )"
value=
".lib $::SKYWATER_MODELS/sky130.lib.spice tt
"}
C {devices/lab_wire.sym} -600 -120 0 1 {name=p21 sig_type=std_logic lab=Vcmm}
C {/foss/designs/xschem/MillerOpAmp/MillerOpAmp.sym} 450 -150 0 0 {name=x1}
C {devices/vdd.sym} 640 -240 0 0 {name=l1 lab=VDD}
C {devices/gnd.sym} 640 -60 0 0 {name=l2 lab=GND}
C {devices/lab_wire.sym} 210 -180 0 0 {name=p1 sig_type=std_logic lab=Vbias2}
C {devices/lab_wire.sym} 210 -160 0 0 {name=p2 sig_type=std_logic lab=Vp}
C {devices/lab_wire.sym} 210 -140 0 0 {name=p3 sig_type=std_logic lab=Vn}
C {devices/lab_wire.sym} 210 -120 0 0 {name=p4 sig_type=std_logic lab=Vbias}
C {devices/lab_wire.sym} 700 -140 0 1 {name=p16 sig_type=std_logic lab=Voutp}
C {devices/lab_wire.sym} 700 -160 0 1 {name=p11 sig_type=std_logic lab=Voutn}
C {devices/capa.sym} 730 -80 0 0 {name=C2
m=1
value=50f
footprint=1206
device="ceramic capacitor"}
C {devices/capa.sym} 730 -230 2 0 {name=C1
m=1
value=50f
footprint=1206
device="ceramic capacitor"}
C {devices/gnd.sym} 730 -30 0 0 {name=l7 lab=GND}
C {devices/gnd.sym} 730 -280 2 0 {name=l11 lab=GND}
C {/foss/designs/xschem/MillerOpAmp/DiffAmp.sym} 240 200 0 0 {name=x2}
C {devices/lab_wire.sym} 30 230 0 0 {name=p12 sig_type=std_logic lab=Vbias}
C {devices/gnd.sym} 420 270 0 0 {name=l12 lab=GND}
C {devices/vdd.sym} 400 60 0 0 {name=l13 lab=VDD}
C {devices/lab_wire.sym} 490 190 0 1 {name=p13 sig_type=std_logic lab=Vbias2}
C {devices/lab_wire.sym} -240 390 0 0 {name=p14 sig_type=std_logic lab=Voutp}
C {devices/lab_wire.sym} -50 80 2 1 {name=p17 sig_type=std_logic lab=Vcmm}
C {sky130_fd_pr/pfet_01v8.sym} -150 -430 0 0 {name=M2
L=2
W=1
nf=2
mult=1
ad="'int((nf+1)/2) * W/nf * 0.29'" 
pd="'2*int((nf+1)/2) * (W/nf + 0.29)'"
as="'int((nf+2)/2) * W/nf * 0.29'" 
ps="'2*int((nf+2)/2) * (W/nf + 0.29)'"
nrd="'0.29 / W'" nrs="'0.29 / W'"
sa=0 sb=0 sd=0
model=pfet_01v8
spiceprefix=X
}
C {devices/lab_wire.sym} -130 -270 0 0 {name=p18 sig_type=std_logic lab=VbiasP}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} 10 -330 1 0 {name=R1
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} 90 -330 1 0 {name=R2
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} 180 -330 1 0 {name=R3
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} 260 -330 1 0 {name=R4
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} 340 -330 1 0 {name=R5
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {devices/lab_wire.sym} -50 -330 0 0 {name=p10 sig_type=std_logic lab=VbiasP}
C {devices/lab_wire.sym} 410 -330 0 1 {name=p19 sig_type=std_logic lab=Vbias}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} -180 390 1 0 {name=R6
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} -100 390 1 0 {name=R7
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} -10 390 1 0 {name=R8
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} 70 390 1 0 {name=R9
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} 150 390 1 0 {name=R10
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {devices/lab_wire.sym} -240 640 2 1 {name=p20 sig_type=std_logic lab=Voutn}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} -180 640 1 1 {name=R11
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} -100 640 1 1 {name=R12
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} -10 640 1 1 {name=R13
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} 70 640 1 1 {name=R14
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {sky130_fd_pr/res_xhigh_po_0p35.sym} 150 640 1 1 {name=R15
L=2
model=res_xhigh_po_0p35
spiceprefix=X
mult=1}
C {devices/lab_wire.sym} 300 510 2 0 {name=p15 sig_type=std_logic lab=VcmmOut}
C {devices/lab_wire.sym} -40 210 2 1 {name=p22 sig_type=std_logic lab=VcmmOut}
C {devices/gnd.sym} -10 320 2 0 {name=l14 lab=GND}
C {devices/gnd.sym} -10 710 0 0 {name=l15 lab=GND}
C {devices/gnd.sym} 180 -400 2 0 {name=l16 lab=GND}
